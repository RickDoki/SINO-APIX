(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5b41b016"],{"174f":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("el-drawer",{attrs:{title:"日志详情",visible:e.drawer,direction:e.direction,"before-close":e.handleClose,size:"50%"},on:{"update:visible":function(t){e.drawer=t}}},[a("json-view",{attrs:{data:this.historylist,theme:"index",deep:2,fontSize:12}})],1),e.routerView?e._e():a("div",[a("div",{staticClass:"list_top"},[a("div",{staticClass:"list_title"},[e._v(e._s(e.serveData.appName))]),a("div",{staticClass:"list_search"},[a("div",{staticClass:"but-left"},[a("el-dropdown",{on:{command:e.handleCommand}},[a("el-button",{attrs:{type:"primary",size:"small"}},[e._v(" 操作"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.dropdownItems,(function(t,n){return a("el-dropdown-item",{key:n,attrs:{command:t}},[e._v(e._s(t))])})),1)],1)],1),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.docsEdit()}}},[e._v("编辑文档")])],1)]),a("div",{staticClass:"secondTitle"},[e._v("创建服务来管理和代理现有API或发布到门户。")]),a("div",{staticClass:"status"},[a("div",{staticClass:"left-span"},[a("span",[e._v("门户状态: ")]),"60001"===e.serveData.isPublished?a("span",{staticClass:"tag info"},[e._v("未发布")]):a("span",{staticClass:"tag success"},[e._v("已发布")])]),a("div",{staticClass:"time"},[a("div",[a("span",[e._v("创建时间 : ")]),a("span",[e._v(e._s(e.serveData.appCreationDate))])]),a("div",[a("span",[e._v("更新时间 : ")]),a("span",[e._v(e._s(e.serveData.appLastUpdateDate))])])])]),a("div",{staticClass:"numbers mode-margin"},[a("div",{staticClass:"requestAll"},[a("div",{staticClass:"font"},[e._v("请求计数")]),a("div",{staticClass:"num"},[e._v(e._s(e.serveNum.totalNum))])]),a("div",{staticClass:"requestError"},[a("div",{staticClass:"font"},[e._v("失败的请求")]),a("div",{staticClass:"num"},[e._v(e._s(e.serveNum.failNum))])]),a("div",{staticClass:"edition"},[a("div",{staticClass:"font"},[e._v("版本计数")]),a("div",{staticClass:"num"},[e._v(e._s(e.serveNum.subscribedNum))])])]),a("div",{staticClass:"table_box mode-margin"},[a("div",{staticClass:"serve-table"},[a("div",{staticClass:"table-tile"},[e._v("版本")]),a("el-button",{staticClass:"add-but",attrs:{plain:"",type:"primary",size:"small"},on:{click:e.gonewEdition}},[e._v("添加版本 ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.versionLoading,expression:"versionLoading"}],attrs:{data:e.serveData.appVersion,"empty-text":"暂无数据","row-style":{height:"50px"},"highlight-current-row":"","header-cell-style":{"font-weight":400,"font-size":"16px",color:"#1D1C35"}}},[a("el-table-column",{attrs:{prop:"version",label:"版本名称"}}),a("el-table-column",{attrs:{prop:"description",label:"版本描述"}}),a("el-table-column",{attrs:{label:"操作",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.edition(t.row)}}},[e._v("编辑")]),a("span",{staticClass:"handle"},[e._v("|")]),a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return e.delversion(t.row)}}},[e._v("删除")])]}}],null,!1,3815511504)})],1)],1),a("div",{staticClass:"table_box mode-margin"},[a("div",{staticClass:"serve-table"},[a("div",{staticClass:"table-tile"},[e._v("插件")]),a("el-button",{staticClass:"add-but",attrs:{plain:"",type:"primary",size:"small"},on:{click:e.goplugin}},[e._v("添加插件 ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.versionLoading,expression:"versionLoading"}],attrs:{data:e.pluginsTable,"empty-text":"暂无数据","row-style":{height:"50px"},"highlight-current-row":"","header-cell-style":{"font-weight":400,"font-size":"16px",color:"#1D1C35"}}},[a("el-table-column",{attrs:{prop:"appName",label:"插件名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(" "+e._s(e._f("plugName")(t.row.pluginType))+" ")])]}}],null,!1,1864104944)}),a("el-table-column",{attrs:{prop:"appCode",label:"启用状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-switch",{attrs:{"active-color":"#6EE4A5","inactive-color":"#E1E6EE","active-value":1,"inactive-value":0},on:{change:function(a){return e.enabledChange(t.row)}},model:{value:t.row.enabled,callback:function(a){e.$set(t.row,"enabled",a)},expression:"scope.row.enabled"}})],1)]}}],null,!1,2317764115)}),a("el-table-column",{attrs:{label:"操作",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.getPluginMessage(t.row)}}},[e._v("查看")]),e.goConfig(t.row.pluginType)?a("span",{staticClass:"handle"},[e._v("|")]):e._e(),e.goConfig(t.row.pluginType)?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.pluginConfig(t.row)}}},[e._v("配置")]):e._e()]}}],null,!1,4285966433)})],1)],1),a("div",{staticClass:"table_box mode-margin"},[e._m(0),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.requestLoding,expression:"requestLoding"}],attrs:{data:e.requestTable,"empty-text":"暂无数据","row-style":{height:"50px"},"highlight-current-row":"","header-cell-style":{"font-weight":400,"font-size":"16px",color:"#1D1C35"}}},[a("el-table-column",{attrs:{prop:"requestUri",label:"请求地址",width:"280px"}}),a("el-table-column",{attrs:{prop:"httpMethod",label:"请求方式"}}),a("el-table-column",{attrs:{prop:"remoteIp",label:"客户端IP"}}),a("el-table-column",{attrs:{prop:"serverIp",label:"服务端IP"}}),a("el-table-column",{attrs:{prop:"consumingTime",label:"耗时(ms)"}}),a("el-table-column",{attrs:{label:"调用时间",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("formatDate")(t.row.eventTime)))])]}}],null,!1,1610164273)}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.getlogs(t.row)}}},[e._v("查看")])]}}],null,!1,2228775102)})],1),a("el-pagination",{staticClass:"list-pagination",attrs:{background:"","current-page":e.currentPageRequest,layout:"prev, pager, next",total:e.totalRequest},on:{"update:currentPage":function(t){e.currentPageRequest=t},"update:current-page":function(t){e.currentPageRequest=t},"current-change":e.handleCurrentChangeRequest}})],1),a("div",{staticClass:"table_box mode-margin"},[e._m(1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.errorLoading,expression:"errorLoading"}],attrs:{data:e.ErrorTable,"row-style":{height:"50px"},"highlight-current-row":"","header-cell-style":{"font-weight":400,"font-size":"16px",color:"#1D1C35"}}},[a("el-table-column",{attrs:{prop:"requestUri",label:"请求地址",width:"280px"}}),a("el-table-column",{attrs:{prop:"httpMethod",label:"请求方式"}}),a("el-table-column",{attrs:{prop:"remoteIp",label:"客户端IP"}}),a("el-table-column",{attrs:{prop:"serverIp",label:"服务端IP"}}),a("el-table-column",{attrs:{prop:"consumingTime",label:"耗时(ms)"}}),a("el-table-column",{attrs:{label:"调用时间",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("formatDate")(t.row.eventTime)))])]}}],null,!1,1610164273)}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.getlogs(t.row)}}},[e._v("查看")])]}}],null,!1,2228775102)})],1),a("el-pagination",{staticClass:"list-pagination",attrs:{background:"","current-page":e.currentPageError,layout:"prev, pager, next",total:e.totalError},on:{"update:currentPage":function(t){e.currentPageError=t},"update:current-page":function(t){e.currentPageError=t},"current-change":e.handleCurrentChangeError}})],1)]),e.routerView?a("router-view"):e._e(),a("plugins-message",{attrs:{drawerProps:e.drawerIsshow,pluginId:e.pluginId},on:{showChange:e.showChange}})],1)},i=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"serve-table"},[a("div",{staticClass:"table-tilelong"},[e._v("请求日志")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"serve-table"},[a("div",{staticClass:"table-tilelong"},[e._v("错误日志")])])}],s=(a("b0c0"),a("fcb4"),a("a1ad")),r=a("080b"),o=a("63b0"),l={components:{jsonView:r["a"],pluginsMessage:o["a"]},filters:{plugName:function(e){var t={jwt:"Jwt-auth",base_auth:"basic_auth",oauth2:"OAuth2.0",black_list_ip:"IP 黑名单控制",white_list_ip:"IP 白名单控制",cors:"cors跨域",sign:"防篡改签名",replay_attacks:"防网络重放攻击",error_log:"error log",http_log:"http log",sentinel:"sentinel",gzip:"gzip",proxy_cache:"proxy_cache",real_ip:"real_ip",response_rewrite:"response-rewrite"};return e?t[e]:""}},data:function(){return{drawerIsshow:!1,routerView:!1,pluginId:"",drawer:!1,historylist:{},direction:"rtl",table:[],pluginsTable:[],dropdownItems:[],appCode:"",serveData:{},serveNum:{},appId:"",versionLoading:!1,currentPageRequest:1,totalRequest:0,requestTable:[],requestLoding:!1,currentPageError:1,totalError:0,ErrorTable:[],errorLoading:!1}},created:function(){"serveDteail"===this.$route.name?(this.routerView=!1,this.appCode=this.$route.params.appcode,this.getServeDeatil(),this.getAppNum(),this.getLog("request"),this.getLog("error")):this.routerView=!0},methods:{showChange:function(){this.drawerIsshow=!1},getPluginMessage:function(e){this.drawerIsshow=!0,this.pluginId=e.id,console.log(e)},handleClose:function(e){e()},getlogs:function(e){this.drawer=!0,this.historylist=e},docsEdit:function(){this.$router.push("/docsEdit/serve?id="+this.appCode+"&name="+this.serveData.appName)},getServeDeatil:function(){var e=this;this.versionLoading=!0,Object(s["t"])(this.appCode).then((function(t){200===t.code&&(e.versionLoading=!1,e.serveData=t.data,e.appId=t.data.appId,e.pluginsTable=t.data.plugins,console.log(e.pluginsTable),"60005"===t.data.isPublished?e.dropdownItems=["下架"]:e.dropdownItems=["发布到门户","删除"])}))},getAppNum:function(){var e=this;Object(s["d"])(this.appCode).then((function(t){200===t.code&&(e.serveNum=t.data)}))},handleCommand:function(e){var t=this;if("下架"===e){var a={isPublished:"60001"};Object(s["v"])(this.appCode,a).then((function(e){200===e.code&&t.getServeDeatil()}))}else if("发布到门户"===e){var n={isPublished:"60005"};Object(s["v"])(this.appCode,n).then((function(e){200===e.code&&t.getServeDeatil()}))}else Object(s["s"])(this.appCode).then((function(e){200===e.code&&t.$router.push({path:"/serve/center"})}))},delversion:function(e){var t=this;this.$confirm("确认删除版本："+e.version+", 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["h"])(e.id).then((function(e){200===e.code&&t.getServeDeatil()}))}))},getLog:function(e){var t=this;if("request"===e){this.requestLoding=!0;var a="appCode="+this.appCode+"&limit=10&offset="+this.currentPageRequest+"&statusCode=200";Object(s["k"])(a).then((function(e){200===e.code&&(t.requestTable=e.data.logList,t.requestLoding=!1,t.totalRequest=e.data.total)}))}else{var n="appCode="+this.appCode+"&limit=10&offset="+this.currentPageError+"&statusCode=500";this.errorLoading=!0,Object(s["k"])(n).then((function(e){200===e.code&&(t.errorLoading=!1,t.ErrorTable=e.data.logList,t.totalError=e.data.total)}))}},handleCurrentChangeRequest:function(e){this.getLog("request")},handleCurrentChangeError:function(e){this.getLog("error")},gonewEdition:function(){this.$router.push({path:"/serve/newEdition?appcode="+this.appCode})},goplugin:function(){this.$router.push({path:"/serve/serveDetail/plug-in?appcode="+this.appCode+"&appid="+this.appId})},edition:function(e){this.$router.push({path:"/serve/editionDetail?appCode="+this.appCode+"&appVersionId="+e.id})},enabledChange:function(e){var t=this;if("sentinel"===e.pluginType)0===e.enabled?Object(s["l"])(e.appId).then((function(a){if(200===a.code){var n={appId:e.appId,appCode:e.appCode,pluginType:e.pluginType,enabled:e.enabled,id:e.id};Object(s["o"])(n).then((function(e){200===e.code&&t.getServeDeatil()}))}})):Object(s["f"])(e.appId).then((function(a){if(200===a.code){var n={appId:e.appId,appCode:e.appCode,pluginType:e.pluginType,enabled:e.enabled,id:e.id};Object(s["o"])(n).then((function(e){200===e.code&&t.getServeDeatil()}))}}));else{var a={appId:e.appId,appCode:e.appCode,pluginType:e.pluginType,enabled:e.enabled,id:e.id};Object(s["o"])(a).then((function(e){200===e.code&&t.getServeDeatil()}))}},pluginConfig:function(e){console.log(e),this.$router.push("/serve/serveDetail/pluginConfig/"+e.pluginType+"?appcode="+e.appCode+"&appid="+e.appId+"&id="+e.id+"&pluginParams=true")},goConfig:function(e){return"jwt"===e||"oauth2"===e||"black_list_ip"===e||"white_list_ip"===e||"cors"===e||"sign"===e||"sentinel"===e}}},u=l,p=(a("ddf1"),a("2877")),d=Object(p["a"])(u,n,i,!1,null,"2c3a5348",null);t["default"]=d.exports},b276:function(e,t,a){},ddf1:function(e,t,a){"use strict";a("b276")}}]);