(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3519f106"],{"0128":function(e,t,a){},8698:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Api_create"},[a("div",{staticClass:"top"},[a("el-steps",{attrs:{active:e.active}},[a("el-step",{attrs:{title:"设置上游服务"}}),a("el-step",{attrs:{title:"设置API信息"}})],1)],1),a("div",{staticClass:"middle"},[1===e.active?a("div",{staticClass:"formBox"},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"130px","label-position":"left",size:"small"}},[a("el-form-item",{attrs:{label:"已有模板:",prop:"name"}},[a("el-select",{staticClass:"inputWidth",attrs:{placeholder:"请选择上游服务",clearable:""},on:{change:e.upstreamChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"服务地址：",prop:"serverAddress"}},[a("el-input",{staticClass:"inputWidth",attrs:{placeholder:"请输入服务地址"},on:{input:function(t){e.addressFlag=!1}},model:{value:e.form.serverAddress,callback:function(t){e.$set(e.form,"serverAddress",t)},expression:"form.serverAddress"}}),a("br"),a("span",{directives:[{name:"show",rawName:"v-show",value:e.addressFlag,expression:"addressFlag"}],staticStyle:{color:"#ff4949","font-size":"12px"}},[e._v("请输入合法的ip地址或服务地址！")])],1),a("el-form-item",{attrs:{label:"服务端口：",prop:"port"}},[a("el-input",{staticClass:"inputWidth",attrs:{placeholder:"请输入服务端口"},model:{value:e.form.port,callback:function(t){e.$set(e.form,"port",e._n(t))},expression:"form.port"}})],1),a("el-form-item",{attrs:{label:"路由前置路径：",prop:"upstreamPrefixPath"}},[a("el-input",{staticClass:"inputWidth",attrs:{placeholder:"请输入路由前置路径"},model:{value:e.form.upstreamPrefixPath,callback:function(t){e.$set(e.form,"upstreamPrefixPath",t)},expression:"form.upstreamPrefixPath"}})],1),a("el-form-item",{attrs:{label:"负载均衡算法：",prop:"loadBalance"}},[a("el-select",{staticClass:"inputWidth",attrs:{placeholder:"请输入上游服务的名称"},model:{value:e.form.loadBalance,callback:function(t){e.$set(e.form,"loadBalance",t)},expression:"form.loadBalance"}},[a("el-option",{attrs:{label:"轮询",value:"roundRobin"}})],1)],1),a("el-form-item",{attrs:{label:"协议：",prop:"protocol"}},[a("el-select",{staticClass:"inputWidth",attrs:{placeholder:"请选择上游服务协议"},model:{value:e.form.protocol,callback:function(t){e.$set(e.form,"protocol",t)},expression:"form.protocol"}},[a("el-option",{attrs:{label:"Http",value:"http"}}),a("el-option",{attrs:{label:"Https",value:"https"}})],1)],1),a("el-form-item",[a("template",{slot:"label"},[a("span",{staticStyle:{position:"relative"}},[a("span",[e._v("重试次数：")]),a("el-tooltip",{staticClass:"item",attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v(" 重试机制将请求发到下一个上游"),a("br"),e._v("节点。值为 0 表示禁用重试机制，"),a("br"),e._v("留空表示使用可用后端节点的数量。 ")])]),a("i",{staticClass:"el-icon-question table-msg"})])],1)]),a("el-input",{staticClass:"selectWidth",attrs:{disabled:"",readonly:""},model:{value:e.tautologyNum,callback:function(t){e.tautologyNum=t},expression:"tautologyNum"}},[a("template",{slot:"append"},[e._v("次")])],2)],2),a("el-form-item",[a("template",{slot:"label"},[a("span",{staticStyle:{position:"relative"}},[a("span",[e._v("连接超时：")]),a("el-tooltip",{staticClass:"item",attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v(" 连接超时时间为系统预设，暂不支持修改。如有需要请联系管理员！ ")])]),a("i",{staticClass:"el-icon-question table-msg"})])],1)]),a("el-input",{staticClass:"selectWidth",attrs:{disabled:"",readonly:""},model:{value:e.connectNum,callback:function(t){e.connectNum=t},expression:"connectNum"}},[a("template",{slot:"append"},[e._v("s")])],2)],2),a("el-form-item",[a("template",{slot:"label"},[a("span",{staticStyle:{position:"relative"}},[a("span",[e._v("发送超时：")]),a("el-tooltip",{staticClass:"item",attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v(" 发送超时时间为系统预设，暂不支持修改。如有需要请联系管理员！ ")])]),a("i",{staticClass:"el-icon-question table-msg"})])],1)]),a("el-input",{staticClass:"selectWidth",attrs:{disabled:"",readonly:""},model:{value:e.sendNum,callback:function(t){e.sendNum=t},expression:"sendNum"}},[a("template",{slot:"append"},[e._v("s")])],2)],2),a("el-form-item",[a("template",{slot:"label"},[a("span",{staticStyle:{position:"relative"}},[a("span",[e._v("接收超时：")]),a("el-tooltip",{staticClass:"item",attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v(" 接收超时时间为系统预设，暂不支持修改。如有需要请联系管理员！ ")])]),a("i",{staticClass:"el-icon-question table-msg"})])],1)]),a("el-input",{staticClass:"selectWidth",attrs:{disabled:"",readonly:""},model:{value:e.receiveNum,callback:function(t){e.receiveNum=t},expression:"receiveNum"}},[a("template",{slot:"append"},[e._v("s")])],2)],2)],1)],1):e._e(),2===e.active?a("div",{staticClass:"apiMiddle"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rulesapi,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"API名称:",prop:"apiName"}},[a("el-input",{staticStyle:{width:"380px"},attrs:{size:"large",maxlength:"20","show-word-limit":""},model:{value:e.ruleForm.apiName,callback:function(t){e.$set(e.ruleForm,"apiName",t)},expression:"ruleForm.apiName"}})],1),a("el-form-item",{attrs:{label:"API路径:",prop:"apiUrl"}},[a("el-input",{staticStyle:{width:"380px"},attrs:{size:"large",maxlength:"500","show-word-limit":""},model:{value:e.ruleForm.apiUrl,callback:function(t){e.$set(e.ruleForm,"apiUrl",t)},expression:"ruleForm.apiUrl"}})],1),a("el-form-item",{attrs:{label:"请求方式:",prop:"requestMethod"}},[a("el-select",{staticStyle:{width:"380px"},attrs:{size:"large",placeholder:""},model:{value:e.ruleForm.requestMethod,callback:function(t){e.$set(e.ruleForm,"requestMethod",t)},expression:"ruleForm.requestMethod"}},[a("el-option",{attrs:{label:"GET",value:"GET"}}),a("el-option",{attrs:{label:"POST",value:"POST"}}),a("el-option",{attrs:{label:"PUT",value:"PUT"}}),a("el-option",{attrs:{label:"DELETE",value:"DELETE"}})],1)],1),a("el-form-item",{attrs:{label:"API版本号:",prop:"apiVersion"}},[a("el-input",{staticStyle:{width:"380px"},attrs:{size:"large",maxlength:"20","show-word-limit":""},model:{value:e.ruleForm.apiVersion,callback:function(t){e.$set(e.ruleForm,"apiVersion",t)},expression:"ruleForm.apiVersion"}})],1),a("el-form-item",{attrs:{label:"API前置路径:",prop:"prefixPath"}},[a("el-input",{staticStyle:{width:"380px"},attrs:{size:"large",maxlength:"500","show-word-limit":""},model:{value:e.ruleForm.prefixPath,callback:function(t){e.$set(e.ruleForm,"prefixPath",t)},expression:"ruleForm.prefixPath"}})],1),a("el-form-item",{attrs:{label:"是否为中台接口:"}},[a("el-select",{staticStyle:{width:"380px"},attrs:{size:"large",placeholder:""},model:{value:e.ruleForm.isInternal,callback:function(t){e.$set(e.ruleForm,"isInternal",t)},expression:"ruleForm.isInternal"}},[a("el-option",{attrs:{label:"是",value:"1"}}),a("el-option",{attrs:{label:"否",value:"0"}})],1)],1),a("el-form-item",{attrs:{label:"API描述:"}},[a("el-input",{staticStyle:{width:"380px"},attrs:{type:"textarea",autosize:{minRows:8,maxRows:15},maxlength:"500","show-word-limit":""},model:{value:e.ruleForm.description,callback:function(t){e.$set(e.ruleForm,"description",t)},expression:"ruleForm.description"}})],1),a("el-form-item",{attrs:{label:"请求参数:"}},[a("div",{on:{contextmenu:e.showMenu}},[a("vxe-table",{ref:"xTable",attrs:{border:"","show-overflow":"",data:e.requestParams,"edit-config":{trigger:"click",mode:"cell"}}},[a("vxe-table-column",{attrs:{type:"checkbox",width:"60"}}),a("vxe-table-column",{attrs:{field:"parame",title:"参数","edit-render":{name:"input"}}}),a("vxe-table-column",{attrs:{field:"type",title:"类型","edit-render":{name:"$select",options:[{value:"Integer",label:"Num"},{value:"String",label:"String"},{value:"Object",label:"Object"},{value:"Float",label:"Float"},{value:"List",label:"List"},{value:"Long",label:"Long"},{value:"Boolean",label:"Boolean"},{value:"Integer",label:"Integer"}]}}}),a("vxe-table-column",{attrs:{field:"isHaveto",title:"是否必选","edit-render":{name:"$select",options:[{value:"是",label:"是"},{value:"否",label:"否"}]}}}),a("vxe-table-column",{attrs:{field:"describe",title:"描述","edit-render":{name:"input"}}}),a("vxe-table-column",{attrs:{field:"default",title:"默认值","edit-render":{name:"input"}}})],1),a("div",{staticClass:"table-button"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.savedata}},[e._v(" 新增 ")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:e.newdata}},[e._v(" 删除 ")])],1)],1)]),a("el-form-item",{attrs:{label:"请求示例:"}},[a("prism-editor",{staticClass:"my-editor height-300",attrs:{highlight:e.highlighter,"line-numbers":e.lineNumbers},model:{value:e.requestExample,callback:function(t){e.requestExample=t},expression:"requestExample"}})],1),a("el-form-item",{attrs:{label:"返回参数:"}},[a("div",{on:{contextmenu:e.showMenu}},[a("vxe-table",{ref:"xTableres",attrs:{border:"","show-overflow":"",data:e.responseParams,"edit-config":{trigger:"click",mode:"cell"}}},[a("vxe-table-column",{attrs:{type:"checkbox",width:"60"}}),a("vxe-table-column",{attrs:{field:"parame",title:"参数","edit-render":{name:"input"}}}),a("vxe-table-column",{attrs:{field:"type",title:"类型","edit-render":{name:"$select",options:[{value:"Integer",label:"Num"},{value:"String",label:"String"},{value:"Object",label:"Object"},{value:"Float",label:"Float"},{value:"List",label:"List"},{value:"Long",label:"Long"},{value:"Boolean",label:"Boolean"},{value:"Integer",label:"Integer"}]}}}),a("vxe-table-column",{attrs:{field:"isHaveto",title:"是否必选","edit-render":{name:"$select",options:[{value:"是",label:"是"},{value:"否",label:"否"}]}}}),a("vxe-table-column",{attrs:{field:"describe",title:"描述","edit-render":{name:"input"}}}),a("vxe-table-column",{attrs:{field:"default",title:"默认值","edit-render":{name:"input"}}})],1),a("div",{staticClass:"table-button"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.savedatares}},[e._v(" 新增 ")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:e.newdatares}},[e._v(" 删除 ")])],1)],1)]),a("el-form-item",{attrs:{label:"返回示例:"}},[a("prism-editor",{staticClass:"my-editor height-300",attrs:{highlight:e.highlighter,"line-numbers":e.lineNumbers},model:{value:e.responseExample,callback:function(t){e.responseExample=t},expression:"responseExample"}})],1)],1)],1):e._e()]),a("div",{staticClass:"bottom"},[a("div",{staticClass:"bottom_button"},[1===e.active?a("div",{staticClass:"user",on:{click:function(t){return e.goNext("form")}}},[e._v(" 下一步 ")]):e._e(),2===e.active?a("div",{staticClass:"user",on:{click:e.goBACK}},[e._v("上一步")]):e._e(),1!==e.active?a("div",{staticClass:"newversion",on:{click:function(t){return e.addSure("ruleForm")}}},[e._v(" 提交 ")]):e._e()])])])},l=[],s=a("1da1"),i=(a("96cf"),a("a4d3"),a("e01a"),a("159b"),a("b0c0"),a("ecbf")),o=a("b2cc"),n=a("e57a"),u=(a("cabf"),a("8c7a")),c=(a("cb55"),a("416b"),a("84bf"),{components:{PrismEditor:n["a"]},data:function(){return{lineNumbers:!0,readonly:!0,contextMenuData:{menuName:"demo",axis:{x:null,y:null},menulists:[{fnHandler:"savedata",icoName:"fa fa-home fa-fw",btnName:"新增一行"},{fnHandler:"newdata",icoName:"fa fa-home fa-fw",btnName:"删除选中 "}]},active:1,tautologyNum:1,connectNum:30,sendNum:15,receiveNum:15,addressFlag:!1,upstreamList:[],options:[],requestParams:[],responseParams:[],requestExample:"",responseExample:"",form:{name:"",description:"",protocol:"",serverAddress:"",port:"",upstreamPrefixPath:"",loadBalance:"roundRobin"},ruleForm:{apiName:"",description:"",apiUrl:"",requestMethod:"",apiVersion:"",markdown:"",domain:"",prefixPath:"",requestParams:"",requestExample:"",responseExample:"",isInternal:"0"},rules:{protocol:[{required:!0,message:"请选择上游服务协议",trigger:"change"}],loadBalance:[{required:!0,message:"请选择负载均衡算法",trigger:"change"}],serverAddress:[{required:!0,message:"请输入服务地址",trigger:"change"}],upstreamPrefixPath:[{pattern:/^\/(?!.*?-$)[a-zA-Z0-9-_/]*$/,message:'请输入合法的路径：以"/"开头，允许字母，数字，下划线，短横线'}],port:[{required:!0,message:"请输入服务端口",trigger:"change"},{pattern:/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/,message:"请输入正确的端口号：1到65535"}]},rulesapi:{apiName:[{required:!0,message:"API名称不能为空",trigger:"change"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"change"}],apiUrl:[{required:!0,message:"API路径不能为空",trigger:"change"},{min:3,max:500,message:"长度在 3 到 500 个字符",trigger:"change"}],requestMethod:[{required:!0,message:"请求方式不能为空",trigger:"change"}],apiVersion:[{required:!0,message:"版本号不能为空",trigger:"change"}]}}},created:function(){this.getList()},methods:{addSure:function(e){var t=this;console.log(JSON.stringify(this.$refs.xTable.afterFullData)),console.log(JSON.stringify(this.$refs.xTableres.afterFullData)),this.$refs[e].validate((function(e){if(e){console.log(t.form),console.log(t.ruleForm);var a={apiName:t.ruleForm.apiName,description:t.ruleForm.description,domain:t.form.serverAddress,apiUrl:t.ruleForm.apiUrl,requestMethod:t.ruleForm.requestMethod,requestParams:JSON.stringify(t.$refs.xTable.afterFullData),responseParams:JSON.stringify(t.$refs.xTableres.afterFullData),requestExample:JSON.stringify(t.requestExample),responseExample:JSON.stringify(t.responseExample),apiVersion:t.ruleForm.apiVersion,isInternal:t.ruleForm.isInternal,upstreamPrefixPath:t.form.upstreamPrefixPath,prefixPath:t.ruleForm.prefixPath,protocol:t.form.protocol,loadBalance:t.form.loadBalance,port:t.form.port};Object(o["a"])(a).then((function(e){200===e.code?(t.$message({message:e.msg,type:"success"}),t.$router.push("/api/list")):(t.ruleForm={},t.$message({message:e.msg,type:"error"}))}))}}))},goBACK:function(){this.active=1,this.$refs["ruleForm"].resetFields()},highlighter:function(e){return Object(u["highlight"])(e,u["languages"].js)},insertEvent:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,l,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=-1,r=e.$refs.xTable,l={parame:"",type:"",isHaveto:"",describe:"",default:""},t.next=5,r.insertAt(l,a);case 5:return s=t.sent,i=s.row,t.next=9,r.setActiveCell(i,"parame");case 9:case"end":return t.stop()}}),t)})))()},insertEventres:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,l,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=-1,r=e.$refs.xTableres,l={parame:"",type:"",isHaveto:"",describe:"",default:""},t.next=5,r.insertAt(l,a);case 5:return s=t.sent,i=s.row,t.next=9,r.setActiveCell(i,"parame");case 9:case"end":return t.stop()}}),t)})))()},showMenu:function(){event.preventDefault();var e=event.clientX,t=event.clientY;this.contextMenuData.axis={x:e,y:t}},savedata:function(){this.insertEvent()},savedatares:function(){this.insertEventres()},newdata:function(){this.$refs.xTable.removeCheckboxRow()},newdatares:function(){this.$refs.xTableres.removeCheckboxRow()},isValidIP:function(e){var t=/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/;return t.test(e)},isValidWeb:function(e){var t=/^(?=^.{3,255}$)[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/;return t.test(e)},getList:function(){var e=this;Object(i["d"])("").then((function(t){if(200===t.code){var a=t.data.upstreamList;e.upstreamList=t.data.upstreamList,a.forEach((function(t){e.options.push({value:t.name,label:t.name})}))}}))},upstreamChange:function(){if(console.log("change"),console.log(this.form.name),""===this.form.name)console.log("ppp"),this.form={name:"",description:"",protocol:"",serverAddress:"",port:"",upstreamPrefixPath:"",loadBalance:"roundRobin"};else for(var e=0;e<this.upstreamList.length;e++)this.upstreamList[e].name==this.form.name&&(this.form={name:this.form.name,description:this.upstreamList[e].description,protocol:this.upstreamList[e].protocol,serverAddress:this.upstreamList[e].server_address,port:this.upstreamList[e].port,upstreamPrefixPath:this.upstreamList[e].prefix_path,loadBalance:"roundRobin"})},goNext:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var a=t.isValidIP(t.form.serverAddress),r=t.isValidWeb(t.form.serverAddress);if(!a&&!r)return t.$message("请输入合法的ip地址或服务地址！"),void(t.addressFlag=!0);t.active=2}}))}}}),m=c,p=(a("b62b"),a("2877")),d=Object(p["a"])(m,r,l,!1,null,"5269e5eb",null);t["default"]=d.exports},b2cc:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return i})),a.d(t,"b",(function(){return o}));var r=a("b775");function l(e){return Object(r["a"])({url:"/app/api/create",method:"post",data:e})}function s(e){return Object(r["a"])({url:"/app/api/list?"+e,method:"get"})}function i(e){return Object(r["a"])({url:"/app/api/"+e,method:"delete"})}function o(e,t){return Object(r["a"])({url:"/app/api/version/"+e,method:"PUT",data:t})}},b62b:function(e,t,a){"use strict";a("0128")},ecbf:function(e,t,a){"use strict";a.d(t,"d",(function(){return l})),a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return i})),a.d(t,"e",(function(){return o})),a.d(t,"b",(function(){return n}));var r=a("b775");function l(e){return Object(r["a"])({url:"/app/upstream/list"+e,method:"get"})}function s(e){return Object(r["a"])({url:"/app/upstream",method:"post",data:e})}function i(e){return Object(r["a"])({url:"/app/upstream/"+e,method:"get"})}function o(e,t){return Object(r["a"])({url:"/app/upstream/"+e,method:"put",data:t})}function n(e){return Object(r["a"])({url:"/app/upstream/"+e,method:"delete"})}}}]);